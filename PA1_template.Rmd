# Reproducible Research: Peer Assessment 1
----  

```{r setup,echo=FALSE}
library(markdown)
library(knitr)
library(plyr)
library(stringr)
library(ggplot2)

setwd("~/RepData_PeerAssessment1")
temp <- unzip("activity.zip")
```
----   

## Reading and preprocessing the data  
**Rubric:  Is there code to read the data?**   
```{r readdata,echo=TRUE}

df <- read.csv(file = "activity.csv"
               , head=TRUE
               , na.strings = "NA"
               )
```
**Rubric:  Is there code to process the data?**  
I want a datetime column...   

```{r makedatetime, echo=TRUE}
df$datetime<-strptime(paste(df$date
                                , " "
                                 , str_sub(paste("0",(60*df$interval%/%100)/60,sep=""),-2,-1)
                                 , ":"           
                                 , str_sub(paste("0",df$interval%%100,sep=""),-2,-1)
                                , ":00"
                                 , sep=""
                           )
                     , "%Y-%m-%d %H:%M:%S"
                     )
df$datetime<- as.POSIXct(strptime(as.character(df$datetime)
                                  , "%Y-%m-%d %H:%M:%S"
                                  )
                         )
```
... and a Weekday/Weekend factor...  

```{r makeweekend,echo=TRUE}
df$weekend <- as.factor(
                        weekdays(df$datetime)=="Saturday"| 
                        weekdays(df$datetime)=="Sunday"
                        )
df$weekend <- ordered(df$weekend,
                     levels = c(TRUE,FALSE),
                     labels = c("Weekend", "Weekday"))
```

Check...  

```{r takealook,echo=TRUE}
str(df)
head(df)
```
  
  Looks good - ready to start analysis!  

----  

## What is mean total number of steps taken per day?  
**Rubric:  Is there a histogram and code for the histogram?**  

```{r makehist1,echo=TRUE, fig.height=4, fig.width=8}

StepsPerDay <-aggregate(steps~date, data=df, sum, na.rm=TRUE)
hist(StepsPerDay$steps
     , xlab="Steps Per Day"
     , main= "Missing Values Removed"
     , cex.axis=.8
     , labels=TRUE
     , ylim=c(0, 40)
     , col="light blue"
     )
grid(NA,NULL,lwd = 2) 
box()

```
Add up the steps for each date...  

```{r makestepsperday,echo=TRUE}

StepsPerDay <-aggregate(steps~date, data=df, sum, na.rm=TRUE)
head(StepsPerDay)
```

###Report the mean and median: 
**Rubric:  Are both the mean and median number of steps taken each day reported?**  
```{r,stepstats,echo=TRUE}
mean(StepsPerDay$steps)
median(StepsPerDay$steps)
```
  
----  

##What is the average daily activity pattern?  
**Rubric: Is there a time series plot of the average number of steps taken (averaged across all days) versus the 5-minute intervals?**  
```{r maketsplot,echo=TRUE, fig.height=4, fig.width=8}
AvgStepsPerInterval <- aggregate(steps~interval, data=df,mean,na.rm=TRUE)

MaxPt <-AvgStepsPerInterval[AvgStepsPerInterval$steps==
                                    max(AvgStepsPerInterval$steps),]

plot(  AvgStepsPerInterval$interval
     , AvgStepsPerInterval$steps
     , type='l' 
     , xlab="Interval"
     , ylab= "Average # Steps"
     , col="blue"
    )
text(  MaxPt$interval
     , MaxPt$steps
     , paste("Max =", trunc(MaxPt$steps,0), "steps @ interval", MaxPt$interval)
     , cex = .8
     , pos = 4
     , col = "red"
    )
grid(NULL,NULL,lwd = 2) 
```
  
**Rubric: Does the report give the 5-minute interval that, on average, contains the maximum number of steps?**  

Here's the answer: The 5-minute interval containing the maximum number of steps is `r MaxPt$interval` and the maximum # of steps is `r MaxPt$steps`, as shown below...  

```{r maximum1,echo=TRUE}
MaxPt
```

----  

## Imputing missing values
Find out how many missing values are in each column of the data...  

```{r summarize,echo=TRUE}
summary(df$steps)
```

### 2. Devise a strategy for filling in all of the missing values in the dataset. 
**Rubric: Does the report *describe* a strategy for imputing missing data?**  

Describe:  My strategy is to replace each missing value with the average # of steps during the same interval from the non-missing rows.  Please see the code chunk below for the calculation.  

NOTE:  I found this code [here](http://stackoverflow.com/questions/9322773/how-to-replace-na-with-mean-by-subset-in-r-impute-with-plyr).   

The new dataset will be named df.imp as shown in the code chunk below.  

**Rubric: Does the report *show with code* a strategy for imputing missing data?**  

```{r imputena,echo=TRUE}
impute.mean <- function(x) replace(x, is.na(x), mean(x, na.rm = TRUE))
df.imp <- ddply(df, ~ interval, transform, steps = impute.mean(steps))  
df.imp<-df.imp[order(df.imp$date,df.imp$interval), ] 

```

Now compare the two data frames to verify no more NAs...  

```{r newsummarize,echo=TRUE}
summary(df.imp$steps)
summary(df$steps)
```

Result:  The mean and median were unaffected but the 3rd Quartile increased by 15.  Not at all surprising given the imputation calculation as interval averages.

**Rubric: Does the report contain a histogram of the total number of steps taken each day after missing values were imputed?**  

```{r hist2, echo=TRUE, fig.height=4, fig.width=8}
  
StepsPerDay.Imp <-aggregate(steps~date, data=df.imp, sum)
hist(  StepsPerDay.Imp$steps
     , xlab = "Steps Per Day"
     , main = "Missing Values Imputed"
     , cex.axis = .8
     , labels = TRUE
     , ylim = c(0, 40)
     , col = "light blue"
     )
grid(NA,NULL,lwd = 2) 
box()

```

The histogram is only slightly changed compared to the first one.  

Just for further comparison, I also compared the statistics.  

```{r stats2,echo=TRUE}

c(sum(StepsPerDay$steps,na.rm=TRUE),sum(StepsPerDay.Imp$steps,na.rm=TRUE))
c(mean(StepsPerDay$steps,na.rm=TRUE),mean(StepsPerDay.Imp$steps,na.rm=TRUE))
c(median(StepsPerDay$steps,na.rm=TRUE),median(StepsPerDay.Imp$steps,na.rm=TRUE))

```


## What is the impact of imputing missing data on the estimates of the total daily number of steps?  

**Rubric:  What was the impact of imputing missing values?**
```{r newmax,echo=TRUE}
MaxPt.Imp
```

The maximum point stayed the same as before.  Not surprising given the imputation method I chose.  

 ----  
 
## Are there differences in activity patterns between weekdays and weekends?  

### Create a new factor variable in the dataset with two levels – “weekday” and “weekend” indicating whether a given date is a weekday or weekend day. 

**NOTE TO ASSESSOR: The weekend column was created during the pre-processing phase at the top of this page.**  

**Rubric: Does the report contain a panel plot comparing the average number of steps taken per 5-minute interval across weekdays and weekends?**  

```{r panelplot,echo=TRUE, fig.height=4, fig.width=8}
AvgStepsPerIntervalWkend.Imp <- aggregate(steps~interval+weekend, data=df.imp,mean)
sp <- ggplot(AvgStepsPerIntervalWkend.Imp, aes(x=interval, y=steps)) + geom_line()+ ylab("Number of Steps")
sp + facet_wrap(~weekend, ncol=1)

```


